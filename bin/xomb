#!perl
#
# xomb - launcher for Game::Xomb

use 5.24.0;
use warnings;
use Getopt::Long qw(GetOptions);
use Game::Xomb;

our ($ddelay, $err, $seed);

GetOptions(
    'help|h|?' => sub {
        warn <<'TLDR';
Usage: xomb [options]

  --err     - send STDERR to this file if not already redirected
  --ddelay  - draw delay in seconds between moves
  --seed    - set the game seed
  --version - shows xomb version and then quits

xomb hides STDERR by default to not show warning or error messages;
debug with a command similar to

  xomb 2>log
  xomb --err=log

and then inspect the log file when things do go awry

TLDR
        exit 64;
    },
    'err=s'     => \$err,
    'ddelay=f'  => \$ddelay,
    'seed=i'    => \$seed,
    'version|v' => sub { say $Game::Xomb::VERSION; exit 1 },
) or exit 64;

$ddelay ||= 0.01;

if (-t STDERR) {
    close STDERR;
    $err //= "$ENV{HOME}/co/Game-Xomb/log";    # DBG
    if (defined $err) {
        unless (open STDERR, '>', $err) {
            say "Could not redirect STDERR to '$err': $!";
            exit 1;
        }
        STDERR->autoflush(1);
    }
}

srand $seed if defined $seed;
Game::Xomb::game_loop($ddelay);
exit(1);                                       # NOTREACHED

__END__

=head1 NAME

B<xomb> - a game featuring @ versus the Xarci Bedo

=head1 SYNOPSIS

B<xomb> [ I<--seed=i> ]

=head1 DESCRIPTION

B<xomb> is a computer fantasy game. The object of the game is to survive
the attacks of the fiendish Xarci Bedo and obtain and escape with the
fabled Dragonstone. Which, despite the name, is actually a vegetable.

=head2 Options

TODO

=head2 An Overview of Minos III 

TODO

=head2 Commands

TODO

=head2 Symbols

TODO

=head1 DIAGNOSTICS

Various messages may be shown by the Patrol Kombat Computer (PKC) in
response to command inputs. Details on important codes are listed below.
Consult the Green Field Operations Manual for complete scenario process
control instructions.

=head2 PKC-0001

A move was attempted beyond the boundaries of the game. In strict mode
this would normally result in the immediate termination of the
contestant.

=head2 PKC-0002

The motion control guidance system has encountered a significant
obstacle and signals that fact with this code.

=head2 PKC-0004

Gate activation error.

=head2 PKC-0010

Dragonstone is required for vertical ascent module gate activation.

=head2 PKC-0098

Gyroscopic control system reports unexpected acceleration.

=head2 PKC-0099

Significant structural integrity breach.

=head2 PKC-0101

Item retrieval command call failure.

=head2 PKC-0102

Inventory stack allocation failure.

-head2 PKC-0104

Item disposal process error. Clear item exit disposal slot before retry.

=head2 PKC-0112

Underflow on inventory stack query request.

=head2 PKC-1203

Spurious interrupt on data bus array.

=head2 PKC-1202

Executive overflow on guidance module.

=head2 PKC-1220

Background subspace comm link protocol error.

=head1 EXIT STATUS

B<xomb> exits with a 0 on victory, and >0 in every other case.

=head1 SEE ALSO

L<Game::Xomb>, L<rogue(6)>

=head1 AUTHOR

Jeremy Mates

=head1 BUGS

B<xomb> assumes that the terminal used has a black background. B<xomb>
assumes that the terminal supports various ANSI or XTerm Control
Sequences.

=cut
