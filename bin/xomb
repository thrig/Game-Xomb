#!perl
#
# launcher for Game::Xomb

use 5.24.0;
use warnings;
use Getopt::Long qw(GetOptions);
use Game::Xomb;

our ($ddelay, $err);

GetOptions(
    'help|h|?' => sub {
        warn <<'TLDR';
Usage: xomb [options]

  --err     - send STDERR to this file if not already redirected
  --ddelay  - draw delay in seconds between moves
  --version - shows xomb version and then quits

xomb hides STDERR by default to not show warning or error messages;
debug with a command similar to

  xomb 2>log
  xomb --err=log

and then inspect the log file when things do go awry

TLDR
        exit 64;
    },
    'err=s'     => \$err,
    'ddelay=f'  => \$ddelay,
    'version|v' => sub { say $Game::Xomb::VERSION; exit 1 },
) or exit 64;

$ddelay ||= 0.01;

if (-t STDERR) {
    close STDERR;
    $err //= "$ENV{HOME}/co/Game-Xomb/log";    # DBG
    if (defined $err) {
        unless (open STDERR, '>', $err) {
            say "Could not redirect STDERR to '$err': $!";
            exit 1;
        }
        STDERR->autoflush(1);
    }
}

# DBG
srand 640;

Game::Xomb::game_loop($ddelay);
exit(1);                                       # NOTREACHED

__END__

=head1 NAME

B<xomb> - a game featuring @ versus the Xarci Bedo

=head1 SYNOPSIS

B<xomb>

=head1 DESCRIPTION

B<xomb> is a computer fantasy game. The object of the game is to
survive the attacks of the fiendish B<Xarci Bedo> and obtain and escape
with the B<Dragonstone>. Which, despite the name, is actually a
vegetable. Oh, and for some reason someone has scattered precious gems
throughout the dungeon. TODO implement gems.

well except the Xarci Bedo doesn't actually exist yet. In this
game, anyways.

=head2 Options

TODO

=head2 An Overview of the Game

TODO

=head2 Commands

TODO

=head2 Symbols

TODO

=head1 DIAGNOSTICS

Various messages may be shown by the Patrol Kombat Computer (PKC) in
response to command inputs. Details on important codes are listed below.
The green operations manual contains full details of all codes.

=head2 PKC-0001

A move was made beyond the boundaries of the game. In strict mode this
would normally result in the immediate termination of the contestant.

=head2 PKC-0002

The command motion control module has encountered a significant obstacle
and signals that fact with this code.

=head2 PKC-0004

Item retrevial command call failure. User is advised to only use the
relevant command in a cell that actually contains an item.

=head2 PKC-0005

Inventory stack allocation failure.

=head2 PKC-0024

A significant problem has occured. Consult the green operations manual
for details.

=head2 PKC-0037

No gate found. This indicates that no gate is present in the cell the
command was attempted in.

=head1 EXIT STATUS

B<xomb> exits with a 0 on victory, and >0 in every other case.

=head1 SEE ALSO

L<Game::Xomb>, L<rogue(6)>

=head1 AUTHOR

Jeremy Mates

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2020 by Jeremy Mates

This program is distributed under the (Revised) BSD License:
L<http://www.opensource.org/licenses/BSD-3-Clause>

=cut
